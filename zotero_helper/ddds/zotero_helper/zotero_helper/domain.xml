<?xml version="1.0" encoding="utf-8"?>
<domain name="ZoteroHelperDomain" is_super_domain="true">

  <goal type="perform" action="top">
    <plan>
      <forget_all/>
      <findout type="goal"/>
    </plan>
  </goal>

  <goal type="resolve" question_type="wh_question" predicate="count">
    <plan>
      <!-- First check if the folder exists  -->
      <bind type="wh_question" predicate="debug"/>
      <bind type="wh_question" predicate="folder_name"/>
      <invoke_service_query predicate="folder_id" type="wh_question"/>
      <if>
        <condition>
          <proposition predicate="folder_id" value="0"/>
        </condition>
        <then>
          <invoke_service_action name="ReportFolderFail" postconfirm="true"/>
        </then>
        <else>
          <!-- <invoke_service_query> does not return multiple variables    -->
          <!-- Need the system to utter "COUNT + TYPE(plural|singular)"     -->
          <!-- e.g. x paper(s),                                             -->
          <!-- predicate count has count+type(plural|singular), while       -->
          <!-- count_int has the count only to use it in the if/then        -->
          <!-- statement                                                    -->
          <bind type="wh_question" predicate="type"/>
          <invoke_service_query predicate="count_type" type="wh_question"/>
          <invoke_service_query predicate="count_int" type="wh_question"/>
          <invoke_service_query predicate="check_type" type="wh_question"/>
          <if>
            <condition>
              <proposition predicate="count_int" value="0"/>
            </condition>
            <then>
              <invoke_service_action name="ReportEmpty" postconfirm="true"/>
              <forget_all/>
            </then>
            <else>
              <invoke_service_action name="ReportCount" postconfirm="true"/>
              <forget_all/>
            </else>
          </if>
        </else>
      </if>
    </plan>
  </goal>

  <parameters predicate="count">
    <background predicate="count_type"/>
    <background predicate="check_type"/>
    <background predicate="folder_name"/>
    <background predicate="folder_id"/>
  </parameters>

</domain>
